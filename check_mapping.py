import json

# 读取爬取的数据
with open('medicines.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 提取所有药名
db_medicines = set([item['title'] for item in data])

# 用户列表中的药物
user_medicines = [
    "麻黄","蜜麻黄","桂枝","防风","荆芥穗","羌活","白芷","细辛","紫苏叶","紫苏梗","辛夷","炒苍耳子","菊花","桑叶","蝉蜕","葛根","升麻","北柴胡","蔓荆子","淡豆豉","盐知母","石膏","焦栀子","淡竹叶","蜜蒙花","天花粉","黄芩片","黄连片","关黄柏","白鲜皮","金银花","连翘","蒲公英","紫花地丁","射干","干鱼腥草","金荞麦","野菊花","忍冬藤","土茯苓","大青叶","败酱草","白花蛇舌草","大血藤(红藤)","荷叶","鬼针草","翻白草","生地黄","玄参","牡丹皮","水牛角丝","赤芍","独活","威灵仙","木瓜","伸筋草","透骨草","路路通","刺五加","防己","秦艽","桑寄生","桑枝","烫狗脊","虎杖","络石藤","乌梢蛇","五加皮","茯神","猪苓","泽泻","盐泽泻","薏苡仁","麸炒薏苡仁","车前草","滑石","滑石粉","海金沙","茵陈","地肤子","冬瓜皮","广金钱草","小通草","大通草","萹蓄","瞿麦","川木通","鱼脑石","大黄","火麻仁","芒硝","麸炒苍术","厚朴","广藿香","砂仁","肉桂","干姜","吴茱萸","盐小茴香","陈皮","麸炒枳壳","麸炒枳实","木香","醋香附","乌药","檀香","大腹皮","炒川楝子","醋延胡索(醋元胡)","预知子","香橼","玫瑰花","生山楂","净山楂","焦山楂","麦芽","炒麦芽","炒神曲","炒六神曲","鸡内金","炒鸡内金","炒槟榔片","鸡矢藤","柿蒂","白茅根","生蒲黄","仙鹤草","茜草","白芨","槐米","侧柏叶","艾叶","地榆炭","蒲黄炭","荆芥穗炭","川芎","郁金","怀牛膝","川牛膝","红花","炒山桃仁","丹参","五灵脂","干益母草","泽兰","卷柏","炒王不留行","鸡血藤","姜黄","醋乳香","醋没药","茺蔚子","水红花子","清半夏","姜半夏","法半夏","桔梗","炒苦杏仁","旋覆花","瓜蒌","竹茹","紫苏子","胆南星","银杏叶","石菖蒲","磁石","煅磁石","炒酸枣仁","蜜远志","合欢皮","首乌藤","紫贝齿","煅石决明","生牡蛎","煅牡蛎","煅赭石","天麻","炒蒺藜","地龙","炒僵蚕","珍珠母","人参片","党参","黄芪","炙黄芪","白术","麸炒白术","山药","麸炒山药","甘草片","炙甘草","太子参","灵芝片","大枣","白扁豆","当归","熟地黄","龙眼肉","白芍","炒白芍","酒白芍","南沙参","北沙参","麦冬","酒黄精","干石斛","桑椹子","枸杞子","女贞子","墨旱莲","醋龟甲","醋鳖甲","黑芝麻","楮实子","巴戟天","肉苁蓉","锁阳","炙淫羊藿","杜仲","盐杜仲","补骨脂","盐补骨脂","盐菟丝子","续断","烫骨碎补","益智仁","五倍子","五味子","山萸肉","麻黄根","浮小麦","海螵蛸","连子","赤石脂","分心木","芡实","蛇床子"
]

# 当前的映射表
current_mapping = {
    "麸炒白术": "白术",
    "炒白术": "白术",
    "麸炒山药": "山药",
    "炒山药": "山药",
    "炒酸枣仁": "酸枣仁",
    "山萸肉": "山茱萸",
    "蜜桑白皮": "桑白皮",
    "黑顺片": "附子",
    "制附子": "附子",
    "黑顺片(制附子)": "附子",
    "炒山桃仁": "桃仁",
    "山桃仁": "桃仁",
    "益智仁": "益智",
    "甘草片": "甘草",
    "炙甘草": "甘草",
    "盐杜仲": "杜仲",
    "醋香附": "香附",
    "醋延胡索": "延胡索",
    "醋元胡": "延胡索",
    "麸炒枳壳": "枳壳",
    "麸炒枳实": "枳实",
    "麸炒苍术": "苍术",
    "炒苍术": "苍术",
    "盐小茴香": "小茴香",
    "炒川楝子": "川楝子",
    "制川乌": "制川乌",
    "蜜麻黄": "麻黄",
    "炮姜": "炮姜"
}

# 检查每个药物
missing = []
found = []
need_mapping = []

for med in user_medicines:
    # 先检查是否直接存在
    if med in db_medicines:
        found.append(med)
    # 检查是否有映射
    elif med in current_mapping:
        mapped = current_mapping[med]
        if mapped in db_medicines:
            found.append(f"{med} -> {mapped}")
        else:
            missing.append(f"{med} -> {mapped} (映射目标不存在)")
    else:
        # 尝试查找可能的匹配
        possible = []
        for db_med in db_medicines:
            if med in db_med or db_med in med:
                possible.append(db_med)
        
        if possible:
            need_mapping.append(f"{med} -> 可能: {', '.join(possible[:3])}")
        else:
            missing.append(med)

print(f"=== 统计 ===")
print(f"总共: {len(user_medicines)} 种药物")
print(f"已找到: {len(found)} 种")
print(f"需要映射: {len(need_mapping)} 种")
print(f"未找到: {len(missing)} 种")

if need_mapping:
    print(f"\n=== 需要添加映射的药物 ({len(need_mapping)}) ===")
    for item in need_mapping:
        print(f"  {item}")

if missing:
    print(f"\n=== 未找到的药物 ({len(missing)}) ===")
    for item in missing:
        print(f"  {item}")

# 生成建议的映射代码
if need_mapping:
    print(f"\n=== 建议添加的映射 ===")
    for item in need_mapping:
        parts = item.split(" -> 可能: ")
        if len(parts) == 2:
            source = parts[0]
            targets = parts[1].split(", ")
            if targets:
                print(f'      "{source}": "{targets[0]}",')
